{% extends 'coaching/base.html' %}

{% block title %}Mon Tableau de Bord{% endblock %}

{% block content %}
    <h2>Mon Tableau de Bord</h2>

    {% if is_coach %}
        {# --- VUE POUR LE COACH --- #}
        <h3>Bonjour Coach {{ user.username }} ! Voici votre planning.</h3>

        {# Le conteneur o√π le calendrier sera dessin√© par JavaScript #}
        <div id='calendar'></div>

    {% else %}
        {# --- VUE POUR LE CLIENT (ne change pas) --- #}
        <h3>Bienvenue, {{ user.username }} !</h3>
        <p><a href="{% url 'prendre-rdv' %}">Prendre un nouveau rendez-vous</a></p>
        <hr>

        <h4>üóìÔ∏è S√©ances √† venir</h4>
        <ul>
            {% for seance in seances_a_venir %}
                <li>
                    <a href="{% url 'seance-detail' seance.pk %}">
                        S√©ance du {{ seance.date|date:"d/m/Y" }} √† {{ seance.heure_debut|time:"H:i" }} - Sujet : {{ seance.sujet }}
                    </a>
                </li>
            {% empty %}
                <li>Aucune s√©ance √† venir.</li>
            {% endfor %}
        </ul>
        <hr>
        <h4>üìú Historique des s√©ances</h4>
        <ul>
            {% for seance in seances_passees %}
                <li>
                    <a href="{% url 'seance-detail' seance.pk %}">
                        S√©ance du {{ seance.date|date:"d/m/Y" }} √† {{ seance.heure_debut|time:"H:i" }} - Sujet : {{ seance.sujet }}
                    </a>
                </li>
            {% empty %}
                <li>Aucune s√©ance dans l'historique.</li>
            {% endfor %}
        </ul>
    {% endif %}

{% endblock %}


{% block extra_js %}
    {# On ajoute ce bloc pour le JavaScript sp√©cifique √† cette page #}
    {% if is_coach %}
        <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

        <script>
            // 2. Initialisation du calendrier
            document.addEventListener('DOMContentLoaded', function() {
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth', // Vue par mois par d√©faut
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    locale: 'fr', // Mettre le calendrier en fran√ßais
                    buttonText: {
                        today:    "Aujourd'hui",
                        month:    'Mois',
                        week:     'Semaine',
                        day:      'Jour',
                    },
                    events: "{% url 'all-seances-api' %}",
                });
                calendar.render();
            });
        </script>
    {% endif %}
{% endblock %}